version: '3.6'

services:
  app:
    image: nginx
    networks:
      - proxy
    volumes:
      - ./www:/usr/share/nginx/html
      - ./nginx.conf:/etc/nginx/conf.d/default.conf
    deploy:
      replicas: 1
      labels:
        - "traefik.http.services.static-app.loadbalancer.server.port=80"
        - "traefik.http.routers.static-app.entrypoints=https,http,https-ext,http-ext"
        - "traefik.http.routers.static-app.rule=Host(`static.${DOMAIN}`) || Host(`www.${DOMAIN}`) || Host(`${DOMAIN}`)"
        #- "traefik.http.routers.static-app.rule=HostRegexp(`{host:.+}`)"
        #- "traefik.http.routers.static-app.priority=1"
        #- "traefik.http.routers.static-app.middlewares=static-app-errorpages"
        #- "traefik.http.middlewares.static-app-errorpages.errors.status=400,401,403,404,409,500"
        #- "traefik.http.middlewares.static-app-errorpages.errors.service=static-app"
        #- "traefik.http.middlewares.static-app-errorpages.errors.query=/{status}.html"

networks:
  proxy:
    name: proxy
    external: true